<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>My Google Map</title>
    <style>
    
        #map{
            height : 400px;
            width : 100%;
        }
    </style>
</head>
<body>
        <h1>My Google Map</h1>
        <div id="map"></div>
        <script>
            function initMap(){
                //Map options
                var latitude, longitude;
                var currentOptions = {
                  enableHighAccuracy: true,
                  timeout: 5000,
                  maximumAge: 0
                };
                function success(pos) {
                    var crd = pos.coords;
                    console.log('Your current position is:');
                    console.log('Latitude : ' + crd.latitude);
                    console.log('Longitude: ' + crd.longitude);
                    console.log('More or less ' + crd.accuracy + ' meters.');
                   
                    var options ={
                    zoom : 15,
                    center : {lat:crd.latitude,lng:crd.longitude}
                }
                //new map
                var map = new google.maps.Map(document.getElementById('map'),options);

                // //Add marker
                // var marker = new google.maps.Marker({
                //     position : {lat:42.4668, lng:-70.9495},
                //     map : map,
                //     icon : 'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png'
                // });

                // var infoWindow = new google.maps.InfoWindow({
                //     content:'<h1>Lynn MA!</h1>'
                // });

                // marker.addListener('click',function(){
                //     infoWindow.open(map, marker);
                // });
            
                // google.maps.event.addListener(map, 'click', function(event){
                //         addMarker({coords:event.latLng});
                // }); 
                var markers = [
                    {
                        coords:{lat : crd.latitude, lng : crd.longitude},
                        iconImage:'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png',
                        content : '<h1>영화정보!</h1>'
                    },
                    // {    
                    //     coords:{lat : 42.8584, lng : -70.9300},
                    //     content : '<h1>으앙</h1>'
                    // }
                ];

                for(var i=0; i<markers.length; i++){
                    addMarker(markers[i]);
                }
                // addMarker({
                //     coords:{lat : 42.4668, lng : -70.9495},
                //     iconImage:'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png',
                //     content : '<h1>Lynn ma!</h1>'
                // });
                // addMarker({    
                //     coords:{lat : 42.8584, lng : -70.9300},
                //     content : '<h1>으앙</h1>'
                // });
                //Add Marker Function 
                function addMarker(props){
                    var marker = new google.maps.Marker({
                    position : props.coords,
                    map : map,
                    //icon : props.iconImage
                });
                    if(props.iconImage){
                        marker.setIcon(props.iconImage);
                    }

                    //check content
                    if(props.content){
                          var infoWindow = new google.maps.InfoWindow({
                             content:props.content
                                });

                          marker.addListener('click',function(){
                              infoWindow.open(map, marker);
                                });
                    }
                }
                };

                function error(err) {
                    console.warn('ERROR(' + err.code + '): ' + err.message);
                };

                navigator.geolocation.getCurrentPosition(success, error, currentOptions);
                
               
            }    
        </script>
        <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAV8216Sn2eXjb0dDX1bhZ_HjZDvctI9JY&callback=initMap&libraries=&v=weekly"
        async
        defer
      ></script>
</body>
</html>